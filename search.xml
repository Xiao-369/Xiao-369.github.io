<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>防火墙基础实验</title>
      <link href="/2025/10/30/%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C/"/>
      <url>/2025/10/30/%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="防火墙基础实验"><a href="#防火墙基础实验" class="headerlink" title="防火墙基础实验"></a>防火墙基础实验</h1><p>这是一个简单的防火墙基本配置，熟悉防火墙区域概念和防火墙的安全策略，简单的配置防火墙的NAT。实现网关冗余和链路冗余，通过MSTP实现VLAN的负载分担。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">要求：</span><br><span class="line">1，IP与VLAN规划如图，未规划的地方可自行补充；</span><br><span class="line">2，pc1/2的IP地址由DHCP获取，AR2为DHCP服务器，PC获取自身编号结尾的IP地址</span><br><span class="line">3，交换机s3/s4部署VRRP，使得PC1在S3上为主用，PC2在S4上为主用；</span><br><span class="line">4，S1/2/3/4四台交换机部署MSTP，结合VRRP，使得网关走最优路径访问网关</span><br><span class="line">5，S3/S4/AR2/FW1之间部署OSPF协议，实现整个内网互联互通；</span><br><span class="line">6，部署防火墙安全策略，使得内网用户正常访问内网服务器；</span><br><span class="line">7，防火墙部署NAT策略，使得内网PC1所在的部门可以访问公网</span><br><span class="line">（200.0.1.1 200.0.1.2）</span><br><span class="line">8，防火墙部署NAT-Server，使得公网用户可以访问server1，不能访问server2 200.0.1.3 200.0.1.4</span><br><span class="line">9，为了安全管控，限制PC1访问PC4</span><br></pre></td></tr></table></figure><p>在进行配置前，需要理清整个拓扑结构，按防火墙划分，我们需要划分三个区域（trust，untrust，dmz），可以先根据区域进行配置。这根据自己的习惯进行。</p><h3 id="配置untrust区域的IP地址和ISIS"><a href="#配置untrust区域的IP地址和ISIS" class="headerlink" title="配置untrust区域的IP地址和ISIS"></a>配置untrust区域的IP地址和ISIS</h3><p>防火墙连接的外网配置成untrust区域，</p><h4 id="配置R2和R3的IP地址"><a href="#配置R2和R3的IP地址" class="headerlink" title="配置R2和R3的IP地址"></a>配置R2和R3的IP地址</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">R2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 100.0.13.20 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 100.0.23.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">R3</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 100.0.23.2 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 100.0.4.10 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> ip address 100.0.3.10 255.255.255.0 </span><br><span class="line">#</span><br></pre></td></tr></table></figure><h4 id="配置ISIS协议"><a href="#配置ISIS协议" class="headerlink" title="配置ISIS协议"></a>配置ISIS协议</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">R1</span><br><span class="line">#</span><br><span class="line">isis 15</span><br><span class="line"> is-level level-2</span><br><span class="line"> network-entity 49.0001.0000.0000.0002.00</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> isis enable 15</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> isis enable 15</span><br><span class="line"></span><br><span class="line">R2</span><br><span class="line">#</span><br><span class="line">isis 15</span><br><span class="line"> is-level level-2</span><br><span class="line"> network-entity 49.0001.0000.0000.0003.00</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> isis enable 15</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> isis enable 15</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> isis enable 15</span><br><span class="line">#</span><br></pre></td></tr></table></figure><h3 id="配置trust区域"><a href="#配置trust区域" class="headerlink" title="配置trust区域"></a>配置trust区域</h3><h4 id="先划分vlan和配置IP地址"><a href="#先划分vlan和配置IP地址" class="headerlink" title="先划分vlan和配置IP地址"></a>先划分vlan和配置IP地址</h4><p>LSW1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vlan batch 20 to 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 20</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>LSW2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vlan batch 20 to 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>LSW3：<strong>随便把端口聚合一起做了，SW4也是一样</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 10.0.1.11 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif21</span><br><span class="line"> ip address 10.0.2.11 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif23</span><br><span class="line"> ip address 10.0.23.30 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif34</span><br><span class="line"> ip address 10.0.34.30 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface MEth0/0/1</span><br><span class="line">#</span><br><span class="line">interface Eth-Trunk0</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21 34</span><br><span class="line"> mode lacp-static</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/3</span><br><span class="line"> eth-trunk 0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> eth-trunk 0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/5</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 23</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>LSW4：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">vlan batch 20 to 21 24 34</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 10.0.1.22 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif21</span><br><span class="line"> ip address 10.0.2.22 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif24</span><br><span class="line"> ip address 10.0.24.40 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif34</span><br><span class="line"> ip address 10.0.34.40 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface MEth0/0/1</span><br><span class="line">#</span><br><span class="line">interface Eth-Trunk0</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21 34</span><br><span class="line"> mode lacp-static</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20 to 21</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/3</span><br><span class="line"> eth-trunk 0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> eth-trunk 0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/5</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 24</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>R1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.0.23.1 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 10.0.24.1 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> ip address 10.0.12.1 255.255.255.0 </span><br><span class="line">#</span><br></pre></td></tr></table></figure><h4 id="部署MSTP"><a href="#部署MSTP" class="headerlink" title="部署MSTP"></a>部署MSTP</h4><p>这里就不贴SW1和SW2了，配置都一样，就是没有配置优先级而已</p><p>LSW3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">stp region-configuration</span><br><span class="line"> region-name huawei</span><br><span class="line"> revision-level 1</span><br><span class="line"> instance 1 vlan 20</span><br><span class="line"> instance 2 vlan 21</span><br><span class="line"> active region-configuration</span><br><span class="line">#</span><br><span class="line">stp instance 1 root primary</span><br><span class="line">stp instance 2 root secondary</span><br></pre></td></tr></table></figure><p>LSW4：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stp region-configuration</span><br><span class="line"> region-name huawei</span><br><span class="line"> revision-level 1</span><br><span class="line"> instance 1 vlan 20</span><br><span class="line"> instance 2 vlan 21</span><br><span class="line"> active region-configuration</span><br><span class="line">#</span><br><span class="line">stp instance 1 root secondary</span><br><span class="line">stp instance 2 root primary</span><br></pre></td></tr></table></figure><p><strong>注意：检查stp的端口状态，一般情况，根桥的端口都是DP，SW1和SW2上有AP口</strong></p><h4 id="配置VRRP，实现网关冗余"><a href="#配置VRRP，实现网关冗余" class="headerlink" title="配置VRRP，实现网关冗余"></a>配置VRRP，实现网关冗余</h4><p>可以联合BFD监测上行链路，感知上行链路故障，实现网关切换</p><p>SW3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bfd</span><br><span class="line">bfd 1 bind peer-ip 10.0.23.1 source-ip 10.0.23.30 auto</span><br><span class="line"> commit</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> vrrp vrid 1 virtual-ip 10.0.1.10</span><br><span class="line"> vrrp vrid 1 priority 150</span><br><span class="line"> vrrp vrid 1 track bfd-session session-name 1 reduced 100</span><br><span class="line">#</span><br><span class="line">interface Vlanif21</span><br><span class="line"> vrrp vrid 1 virtual-ip 10.0.2.10</span><br><span class="line"></span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>SW4：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bfd</span><br><span class="line">bfd 1 bind peer-ip 10.0.24.1 source-ip 10.0.24.40 auto</span><br><span class="line"> commit</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> vrrp vrid 1 virtual-ip 10.0.1.10</span><br><span class="line">#</span><br><span class="line">interface Vlanif21</span><br><span class="line"> vrrp vrid 1 virtual-ip 10.0.2.10</span><br><span class="line"> vrrp vrid 1 priority 150</span><br><span class="line"> vrrp vrid 1 track bfd-session session-name 1 reduced 100</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>R1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bfd 1 bind peer-ip 10.0.23.30 source-ip 10.0.23.1 auto</span><br><span class="line"> commit</span><br><span class="line">#</span><br><span class="line">bfd 2 bind peer-ip 10.0.24.40 source-ip 10.0.24.1 auto</span><br><span class="line"> commit</span><br><span class="line">#</span><br></pre></td></tr></table></figure><h4 id="部署DHCP服务器，为PC分配IP"><a href="#部署DHCP服务器，为PC分配IP" class="headerlink" title="部署DHCP服务器，为PC分配IP"></a>部署DHCP服务器，为PC分配IP</h4><p>这里可以先配置OSPF，在配置DHCP，不然可能DHCP配错了获取不到地址，还要排错</p><p>R1:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip pool vlan20</span><br><span class="line"> gateway-list 10.0.1.10 </span><br><span class="line"> network 10.0.1.0 mask 255.255.255.0 </span><br><span class="line"> static-bind ip-address 10.0.1.1 mac-address 5489-984c-2315 </span><br><span class="line">#</span><br><span class="line">ip pool vlan21</span><br><span class="line"> gateway-list 10.0.2.10 </span><br><span class="line"> network 10.0.2.0 mask 255.255.255.0 </span><br><span class="line"> static-bind ip-address 10.0.2.2 mac-address 5489-98a7-5ac0 </span><br><span class="line">#</span><br><span class="line">dhcp enable</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> dhcp select global</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> dhcp select global</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>这里需要配置dhcp中继，</p><p>SW3:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dhcp enable</span><br><span class="line">int vlan20</span><br><span class="line"> dhcp select relay</span><br><span class="line"> dhcp relay server-ip 10.0.23.1</span><br><span class="line">int vlan21</span><br><span class="line"> dhcp select relay</span><br><span class="line"> dhcp relay server-ip 10.0.23.1</span><br></pre></td></tr></table></figure><p>SW4:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dhcp enable</span><br><span class="line">int vlan20</span><br><span class="line"> dhcp select relay</span><br><span class="line"> dhcp relay server-ip 10.0.24.1</span><br><span class="line">int vlan21</span><br><span class="line"> dhcp select relay</span><br><span class="line"> dhcp relay server-ip 10.0.24.1</span><br></pre></td></tr></table></figure><h4 id="配置OSPF"><a href="#配置OSPF" class="headerlink" title="配置OSPF"></a>配置OSPF</h4><p>SW3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 router-id 30.30.30.30</span><br><span class="line"> silent-interface Vlanif20</span><br><span class="line"> silent-interface Vlanif21</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.0.1.0 0.0.0.255</span><br><span class="line">  network 10.0.2.0 0.0.0.255</span><br><span class="line">  network 10.0.23.0 0.0.0.255</span><br><span class="line">  network 10.0.34.0 0.0.0.255</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>SW4：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 router-id 40.40.40.40</span><br><span class="line"> silent-interface Vlanif20</span><br><span class="line"> silent-interface Vlanif21</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.0.1.0 0.0.0.255</span><br><span class="line">  network 10.0.2.0 0.0.0.255</span><br><span class="line">  network 10.0.24.0 0.0.0.255</span><br><span class="line">  network 10.0.34.0 0.0.0.255</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>R1:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 router-id 10.10.10.10 </span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 10.0.12.0 0.0.0.255 </span><br><span class="line">  network 10.0.23.0 0.0.0.255 </span><br><span class="line">  network 10.0.24.0 0.0.0.255 </span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>检查PC是否获取到地址</p><h3 id="配置DMZ区域"><a href="#配置DMZ区域" class="headerlink" title="配置DMZ区域"></a>配置DMZ区域</h3><p>DMZ区域没什么要配的，就只要配地址就行</p><h3 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h3><p>先把IP地址配了，然后把接口加入对应区域，配置OSPF是整个内网互通（注意：不要宣告untrust网段）</p><p>这里就不逐一配置了</p><p>FW1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">配置IP地址，并加入区域</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/0</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address 10.0.12.10 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/1</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address 100.0.13.10 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/2</span><br><span class="line"> undo shutdown</span><br><span class="line"> ip address 10.0.3.10 255.255.255.0</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">firewall zone trust</span><br><span class="line"> add interface GigabitEthernet1/0/0</span><br><span class="line">#</span><br><span class="line">firewall zone untrust</span><br><span class="line"> add interface GigabitEthernet1/0/1</span><br><span class="line">#</span><br><span class="line">firewall zone dmz</span><br><span class="line"> add interface GigabitEthernet1/0/2</span><br><span class="line">#</span><br><span class="line">配置ospf</span><br><span class="line">ospf 1 router-id 1.1.1.1</span><br><span class="line"> silent-interface GigabitEthernet1/0/2</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.0.3.0 0.0.0.255</span><br><span class="line">  network 10.0.12.0 0.0.0.255</span><br><span class="line">配置安全策略，这里把访问untrust区域也放行了</span><br><span class="line">#</span><br><span class="line">security-policy</span><br><span class="line"> rule name trust_untrust</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  action permit</span><br><span class="line"> rule name trust_dmz</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone dmz</span><br><span class="line">  action permit</span><br><span class="line">#这样可以测试整个内网互通了</span><br></pre></td></tr></table></figure><p>配置NAT</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nat address-group Internet </span><br><span class="line"> section 0 200.0.1.1 200.0.1.2</span><br><span class="line">#</span><br><span class="line">nat-policy</span><br><span class="line"> rule name Internet</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address 10.0.1.0 mask 255.255.255.0</span><br><span class="line">  action source-nat address-group Internet</span><br><span class="line">#</span><br><span class="line">这里配完之后，还是不通的，因为我们转换后的IP为200.0.1.1，公网并没有该路由，我们还要在R2上配置静态路由回来，要是嫌麻烦，可以将地址池设置为接口网段，这样就可以省下面步骤</span><br><span class="line">R2</span><br><span class="line">#</span><br><span class="line">ip route-static 200.0.1.0 255.255.255.0 100.0.13.10</span><br><span class="line">#</span><br><span class="line">isis 15</span><br><span class="line"> import-route static </span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>配置NAT-Server</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">destination-nat address-group web 0</span><br><span class="line"> section 10.0.3.1 10.0.3.1</span><br><span class="line">#</span><br><span class="line">nat-policy</span><br><span class="line"> rule name web</span><br><span class="line">  source-zone untrust</span><br><span class="line">  destination-address 200.0.1.3 mask 255.255.255.255</span><br><span class="line">  destination-address 200.0.1.4 mask 255.255.255.255</span><br><span class="line">  action destination-nat address-group web</span><br><span class="line"> #</span><br><span class="line"> security-policy</span><br><span class="line">  rule name untrust_dmz</span><br><span class="line">  source-zone untrust</span><br><span class="line">  destination-zone dmz</span><br><span class="line">  action permit</span><br><span class="line"> #</span><br><span class="line"> PC1不能访问PC4</span><br><span class="line"> security-policy</span><br><span class="line"> rule name trust_untrust</span><br><span class="line">  destination-address-exclude 100.0.4.1 mask 255.255.255.255</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> HCIA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HCIA综合实验</title>
      <link href="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/"/>
      <url>/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="HCIA综合实验"><a href="#HCIA综合实验" class="headerlink" title="HCIA综合实验"></a>HCIA综合实验</h1><p>HCIP实训3个月，转眼间。该学的知识已经学完了，反过头来做了IA实验，巩固IA的知识</p><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017182257400.png" class="" title="image-20251017182257400"><p>现在看这个拓扑很简单，想起来当初学的时候，真实烧脑，废话少说，直接开干。</p><h4 id="1，基于IP地址表，规划并配置IP"><a href="#1，基于IP地址表，规划并配置IP" class="headerlink" title="1，基于IP地址表，规划并配置IP"></a>1，基于IP地址表，规划并配置IP</h4><p>首先在每个路由器上的接口配置IP，PC上不需要配置IP地址，根据DHCP服务器分配地址</p><p>R1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 172.16.130.1 255.255.255.0</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 10.1.12.1 255.255.255.0 </span><br></pre></td></tr></table></figure><p>R2:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># </span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.1.12.2 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 10.1.23.2 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> ip address 10.1.24.2 255.255.255.0 </span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>R3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.1.23.3 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 3.3.3.254 255.255.255.0 </span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>R4：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.1.24.4 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 4.4.4.254 255.255.255.0 </span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>SW3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">vlan batch 10 20 30 40 13</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.10.254 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.20.254 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 192.168.30.254 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 192.168.40.254 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif13</span><br><span class="line"> ip address 172.16.130.30 255.255.255.0</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p><strong>注意：此时交换机虽然配置vlanif，但是对应接口并没有绑定vlan，所以vlanif没有up</strong></p><h4 id="2，使交换机SW3成为所有VLAN的根桥，要求手动修改优先级为4096"><a href="#2，使交换机SW3成为所有VLAN的根桥，要求手动修改优先级为4096" class="headerlink" title="2，使交换机SW3成为所有VLAN的根桥，要求手动修改优先级为4096"></a>2，使交换机SW3成为所有VLAN的根桥，要求手动修改优先级为4096</h4><p>配置STP，华为默认运行的是MSTP，需要修改为STP。虽然在这里效果一样，但还是按照STP做</p><p>SW3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stp mode stp</span><br><span class="line">stp instance 0 priority 4096</span><br></pre></td></tr></table></figure><p>验证：正常情况下，根桥的所有端口角色都是DP</p><p>​<img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017190829531.png" class="" title="image-20251017190829531"></p><h4 id="3，SW3为各个VLAN内的主机动态分配网络地址信息"><a href="#3，SW3为各个VLAN内的主机动态分配网络地址信息" class="headerlink" title="3，SW3为各个VLAN内的主机动态分配网络地址信息"></a>3，SW3为各个VLAN内的主机动态分配网络地址信息</h4><p>配置地址池，dhcp分配地址。但是首先接口要绑定vlan</p><p>SW1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 20</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10 20 30 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10 20 30 40</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>SW2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 30</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10 20 30 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10 20 30 40</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>SW3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10 20 30 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10 20 30 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/3</span><br><span class="line"> port link-type access</span><br><span class="line"> port default vlan 13</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>接口绑定完，接下来就是DHCP的配置了</p><p>SW3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">dhcp enable</span><br><span class="line">#</span><br><span class="line">ip pool vlan10</span><br><span class="line"> gateway-list 192.168.10.254</span><br><span class="line"> network 192.168.10.0 mask 255.255.255.0</span><br><span class="line"> dns-list 3.3.3.3</span><br><span class="line">#</span><br><span class="line">ip pool vlan20</span><br><span class="line"> gateway-list 192.168.20.254</span><br><span class="line"> network 192.168.20.0 mask 255.255.255.0</span><br><span class="line"> dns-list 3.3.3.3</span><br><span class="line">#</span><br><span class="line">ip pool vlan30</span><br><span class="line"> gateway-list 192.168.30.254</span><br><span class="line"> network 192.168.30.0 mask 255.255.255.0</span><br><span class="line"> dns-list 3.3.3.3</span><br><span class="line">#</span><br><span class="line">ip pool vlan40</span><br><span class="line"> gateway-list 192.168.40.254</span><br><span class="line"> network 192.168.40.0 mask 255.255.255.0</span><br><span class="line"> dns-list 3.3.3.3</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.10.254 255.255.255.0</span><br><span class="line"> dhcp select global</span><br><span class="line">#</span><br><span class="line">interface Vlanif13</span><br><span class="line"> ip address 172.16.130.30 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.20.254 255.255.255.0</span><br><span class="line"> dhcp select global</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 192.168.30.254 255.255.255.0</span><br><span class="line"> dhcp select global</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 192.168.40.254 255.255.255.0</span><br><span class="line"> dhcp select global</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>验证：每台PC都要进行验证，华为都是从大到小分配IP，<strong>注意配置dns。</strong></p><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017191027408.png" class="" title="image-20251017191027408"><h4 id="4，企业内网运行OSPF-1，实现互通"><a href="#4，企业内网运行OSPF-1，实现互通" class="headerlink" title="4，企业内网运行OSPF 1，实现互通"></a>4，企业内网运行OSPF 1，实现互通</h4><p>SW3上将vlanif配置为静默接口，不做强制要求</p><p>SW3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 router-id 30.30.30.30</span><br><span class="line"> silent-interface Vlanif10</span><br><span class="line"> silent-interface Vlanif20</span><br><span class="line"> silent-interface Vlanif30</span><br><span class="line"> silent-interface Vlanif40</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.10.0 0.0.0.255</span><br><span class="line">  network 192.168.20.0 0.0.0.255</span><br><span class="line">  network 192.168.30.0 0.0.0.255</span><br><span class="line">  network 192.68.40.0 0.0.0.255</span><br><span class="line">  network 172.16.130.0 0.0.0.255</span><br></pre></td></tr></table></figure><p>AR1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 router-id 1.1.1.1 </span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 172.16.130.0 0.0.0.255 </span><br></pre></td></tr></table></figure><p><strong>AR1上的G0&#x2F;0&#x2F;1接口不能宣告进OSPF，会导致跟外网建立OSPF关系</strong></p><p>验证：有OSPF邻居关系，如果没有路由的话，可能是宣告错误，自己要学会排错。比如：如果OSPF没建立邻居，则看直连能通嘛</p><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017191700210.png" class="" title="image-20251017191700210"><h4 id="5，ISP中运行OSPF-2，实现互通"><a href="#5，ISP中运行OSPF-2，实现互通" class="headerlink" title="5，ISP中运行OSPF 2，实现互通"></a>5，ISP中运行OSPF 2，实现互通</h4><p>静默接口可以不配，但是一般连接终端要配</p><p>AR2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">silent-interface GigabitEthernet0/0/0</span><br><span class="line">area 0.0.0.0 </span><br><span class="line"> network 10.1.12.0 0.0.0.255 </span><br><span class="line"> network 10.1.23.0 0.0.0.255 </span><br><span class="line"> network 10.1.24.0 0.0.0.255 </span><br></pre></td></tr></table></figure><p>AR3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 2 router-id 3.3.3.3 </span><br><span class="line"> silent-interface GigabitEthernet0/0/1</span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 3.3.3.0 0.0.0.255 </span><br><span class="line">  network 10.1.23.0 0.0.0.255 </span><br></pre></td></tr></table></figure><p>AR4：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 2 router-id 4.4.4.4 </span><br><span class="line"> silent-interface GigabitEthernet0/0/1</span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 4.4.4.0 0.0.0.255 </span><br><span class="line">  network 10.1.24.0 0.0.0.255 </span><br></pre></td></tr></table></figure><p>配置：</p><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017192220245.png" class="" title="image-20251017192220245"><h4 id="6，R1和R2之间封装协议为PPP，使用CHAP双向认证，账号13577475899，密码为xiao"><a href="#6，R1和R2之间封装协议为PPP，使用CHAP双向认证，账号13577475899，密码为xiao" class="headerlink" title="6，R1和R2之间封装协议为PPP，使用CHAP双向认证，账号13577475899，密码为xiao"></a>6，R1和R2之间封装协议为PPP，使用CHAP双向认证，账号13577475899，密码为xiao</h4><p>AR1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface Dialer0</span><br><span class="line"> link-protocol ppp</span><br><span class="line"> ppp chap user 13577475899</span><br><span class="line"> ppp chap password cipher %$%$e/FRO&#123;|4.:M8)ZCBN!8;,.(6%$%$</span><br><span class="line"> ip address ppp-negotiate</span><br><span class="line"> dialer user 1</span><br><span class="line"> dialer bundle 100</span><br><span class="line"> dialer-group 1</span><br><span class="line">#</span><br><span class="line">dialer-rule</span><br><span class="line"> dialer-rule 1 ip permit</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pppoe-client dial-bundle-number 100 </span><br></pre></td></tr></table></figure><p>AR2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">aaa </span><br><span class="line"> local-user 13577475899 password cipher %$%$b4bgBr`&#x27;&#125;8Yp)55T;&gt;K.ZnTX%$%$</span><br><span class="line"> local-user 13577475899 service-type ppp</span><br><span class="line">#</span><br><span class="line">ip pool pppoe</span><br><span class="line"> network 10.1.12.0 mask 255.255.255.0 </span><br><span class="line"> excluded-ip-address 10.1.12.2 </span><br><span class="line">#</span><br><span class="line">interface Virtual-Template0</span><br><span class="line"> ppp authentication-mode chap </span><br><span class="line"> remote address pool pppoe</span><br><span class="line"> ip address 10.1.12.2 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pppoe-client dial-bundle-number 100 </span><br></pre></td></tr></table></figure><p>原本想做PPP的，然后发现拉的是网线，只能做PPPoE</p><p>验证：</p><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017194820297.png" class="" title="image-20251017194820297"><h4 id="7，在R1上配置NAPT"><a href="#7，在R1上配置NAPT" class="headerlink" title="7，在R1上配置NAPT"></a>7，在R1上配置NAPT</h4><p>出口设备除了配置NAPT，还需要配置默认路由,<strong>注意在ospf中下发默认路由</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">nat address-group 0 10.1.12.230 10.1.12.240</span><br><span class="line">#</span><br><span class="line">interface Dialer0</span><br><span class="line"> nat outbound 2000 address-group 0 </span><br><span class="line">#</span><br><span class="line">acl number 2000  </span><br><span class="line"> rule 5 permit </span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 Dialer0</span><br><span class="line">#ospf 1</span><br><span class="line"> default-route-advertise</span><br></pre></td></tr></table></figure><p>验证：</p><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017214112638.png" class="" title="image-20251017214112638"><h4 id="8，vlan20-不能访问DNS，vlan40不能访问HTTP"><a href="#8，vlan20-不能访问DNS，vlan40不能访问HTTP" class="headerlink" title="8，vlan20 不能访问DNS，vlan40不能访问HTTP"></a>8，vlan20 不能访问DNS，vlan40不能访问HTTP</h4><p>AR1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">acl number 3000  </span><br><span class="line"> rule 5 deny ip source 192.168.20.0 0.0.0.255 destination 3.3.3.0 0.0.0.255 </span><br><span class="line"> rule 10 deny ip source 192.168.40.0 0.0.0.255 destination 4.4.4.0 0.0.0.255 </span><br><span class="line"> rule 999 permit ip </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> traffic-filter inbound acl 3000</span><br></pre></td></tr></table></figure><p>验证：</p><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017215452343.png" class="" title="image-20251017215452343"><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017215514363.png" class="" title="image-20251017215514363"><h4 id="9，除vlan40，其他设备通过域名（www-http-com）访问http服务qi（ping）"><a href="#9，除vlan40，其他设备通过域名（www-http-com）访问http服务qi（ping）" class="headerlink" title="9，除vlan40，其他设备通过域名（www.http.com）访问http服务qi（ping）"></a>9，除vlan40，其他设备通过域名（<a href="http://www.http.com)访问http服务qi(ping)/">www.http.com）访问http服务qi（ping）</a></h4><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017215611198.png" class="" title="image-20251017215611198"><img src="/2025/10/17/HCIA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20251017215713169.png" class="" title="image-20251017215713169"><p>PC2用域名访问时，首先会进行发送DNS报文，获取IP地址，因为已经做了ACL限制访问DNS服务器，所以不能获取到IP地址，自然访问不了HTTP服务器。</p><p>PC4能进行DNS解析，但最后还是通过IP地址访问HTTP服务器，已经做了ACL过滤，也不能访问HTTP服务器。</p><p>其他两台PC都能正常访问。</p><h4 id="最后的最后"><a href="#最后的最后" class="headerlink" title="最后的最后"></a>最后的最后</h4><p>实验已经做完了。感触良多。。。。。。。。。</p>]]></content>
      
      
      <categories>
          
          <category> HCIA实验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HCIA </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
